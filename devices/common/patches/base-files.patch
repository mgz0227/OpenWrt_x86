--- a/package/base-files/files/lib/functions.sh
+++ b/package/base-files/files/lib/functions.sh
@@ -395,10 +395,13 @@ default_postinst() {
 			if [ "$PKG_UPGRADE" != "1" ]; then
 				"$i" enable
 			fi
-			"$i" start
+			if "$i" enabled; then
+				"$i" start
+			fi
 		fi
 	done
 
+	[ -x /etc/init.d/ucitrack ] && /etc/init.d/ucitrack reload
 	return $ret
 }
 

--- a/package/base-files/files/etc/shinit
+++ b/package/base-files/files/etc/shinit
@@ -2,6 +2,8 @@
 [ -x /usr/bin/vim ] && alias vi=vim || alias vim=vi
 
 alias ll='ls -alF --color=auto'
+alias reboot='(/bin/busybox reboot &);sleep 3;/bin/busybox reboot -f'
+PS1='\[\e[32m\][\[\e[m\]\[\e[31m\]\u\[\e[m\]\[\e[33m\]@\[\e[m\]\[\e[32m\]\h\[\e[m\]:\[\e[m\]\[\e[32m\]\[\e[1;32m\]\@\[\e[36m\] \w\[\e[m\]\[\e[32m\]]\[\e[0m\] \$\[\e[m\] '
 
 [ -z "$KSH_VERSION" -o \! -s /etc/mkshrc ] || . /etc/mkshrc

--- a/package/base-files/files/sbin/sysupgrade
+++ b/package/base-files/files/sbin/sysupgrade
@@ -284,6 +284,16 @@
 		# Part of archive with installed packages info
 		if [ $ret -eq 0 ]; then
 			if [ "$SAVE_INSTALLED_PKGS" -eq 1 ]; then
+				# Optional: run opkg save if available (ignore failures)
+				[ -r /etc/profile.d/opkg.sh ] && . /etc/profile.d/opkg.sh >/dev/null 2>&1
+				type -t opkg >/dev/null 2>&1 && opkg save >/dev/null 2>&1
+
+				# Ensure ASU defaults script is included in backup (if present in /rom)
+				[ -f /rom/etc/uci-defaults/zz-asu-defaults ] && {
+					cp -f /rom/etc/uci-defaults/zz-asu-defaults /etc/uci-defaults/zz-asu-defaults
+					echo "/etc/uci-defaults/zz-asu-defaults" >> "$CONFFILES"
+				}
+
 				# Format: pkg-name<TAB>{rom,overlay,unknown}
 				# rom is used for pkgs in /rom, even if updated later
 				if [ -d "/usr/lib/opkg/info" ]; then
@@ -299,6 +309,11 @@
 						\( -exec echo {} unknown \; \) \
 						\) | sed -e 's,.*/,,;s/\.list /\t/')" || ret=1
 				fi
+			else
+				# If not saving installed packages, reset opkg uci state (ignore failures)
+				uci -q del opkg.auto
+				uci -q del opkg.custom
+				uci commit op
 			fi
 		fi
 

 

--- a/package/base-files/files/etc/profile
+++ b/package/base-files/files/etc/profile
@@ -32,8 +32,11 @@
 
 if [ -z "$FAILSAFE" ] ; then
 	for FILE in /etc/profile.d/*.sh ; do
-		[ -f "${FILE%.sh}.hush" ] && continue
-		[ -f "$FILE" ] && . "$FILE"
+		if [ "$FILE" == "/etc/profile.d/30-sysinfo.sh" ]; then
+		 [ "$(which bash)" ] && env -i bash "$FILE"
+		else
+		 [ -e "$FILE" ] && . "$FILE"
+		fi
 	done
 	unset FILE
 fi
\ No newline at end of file


--- a/package/base-files/files/lib/preinit/02_sysinfo
+++ b/package/base-files/files/lib/preinit/02_sysinfo
@@ -5,6 +5,7 @@ do_sysinfo_generic() {
 		echo "$(strings /proc/device-tree/compatible | head -1)" > /tmp/sysinfo/board_name
 	[ ! -e /tmp/sysinfo/model -a -e /proc/device-tree/model ] && \
 		echo "$(cat /proc/device-tree/model)" > /tmp/sysinfo/model
+	sed -i "s/friendlyelec/friendlyarm/" /tmp/sysinfo/board_name
 }
 
 boot_hook_add preinit_main do_sysinfo_generic

